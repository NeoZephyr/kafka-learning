## TCP 连接
在调用 poll 方法时被创建的，而 poll 方法内部有 3 个时机可以创建 TCP 连接

### 创建连接
1. 发起 FindCoordinator 请求
当消费者程序首次启动调用 poll 方法时，它需要向 Kafka 集群（集群中的任意服务器）发送一个名为 FindCoordinator 的请求，以获取对应的协调者（驻留在 Broker 端的内存中，负责消费者组的组成员管理和各个消费者的位移提交管理）。然后，消费者会创建一个 Socket 连接

2. 连接协调者
Broker 处理完 FindCoordinator 请求之后，会返还对应的响应结果，告诉消费者哪个 Broker 是真正的协调者，然后，消费者会创建连向该 Broker 的 Socket 连接。只有成功连入协调者，协调者才能开启正常的组协调操作，比如加入组、等待组分配方案、心跳请求处理、位移获取、位移提交等

3. 消费数据
消费者会为每个要消费的分区创建与该分区领导者副本所在 Broker 连接的 TCP

需要注意的是，当第三类 TCP 连接成功创建后，消费者程序就会废弃第一类 TCP 连接，之后在定期请求元数据时，它会改为使用第三类 TCP 连接

### 关闭连接
1. 主动关闭
手动调用 KafkaConsumer.close() 方法，或者是执行 Kill 命令

2. 自动关闭
由消费者端参数 `connection.max.idle.ms` 控制，该参数默认值是 9 分钟，即如果某个 Socket 连接上连续 9 分钟都没有任何请求，那么消费者会强行杀掉这个 Socket 连接